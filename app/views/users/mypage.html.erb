<div class="border-bottom">
  <div class="row px-3 mx-5 pt-3 pb-4">
    <h1 class="col-sm-7 px-0">comm-list</h1>
    <div class="col-sm-5 d-flex align-items-center justify-content-end px-0">
      <div class="px-0">
        <img style="width:30px" src=<%= @user.image_url %> class="rounded-circle pb-1">
        <%= @user.name%>
        @<%= @user.screen_name%>
        <%= link_to 'ログアウト',"/", onclick: 'firebaseLogout();return false;', class: 'btn btn-secondary ml-5' %>
      </div>
    </div>
  </div>
</div>
<br>

<div class="modal fade" id="edit-team" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div id="room-name-modal">
        <%= render 'teams/edit_team_form', team: @team %>
      </div>
    </div>
  </div>
</div>

<div class="px-3 mx-5" id="view-data">
  <div class="card m-3 p-5">
    <div class="m-0 px-0 pt-3 mx-auto" style="width:250px">
      <img style="width:250px" src=<%= @user.image_url %> class="rounded-circle">
    </div>
    <div class="mb-4 px-0 py-3 mx-auto">
      <h1 class="text-center"><%= @user.name %></h1>
      <h5 class="text-center text-secondary p-0 m-0">@<%= @user.screen_name %></h5>
    </div>
    <div class="row py-3 pr-1 d-flex align-items-center justify-content-end">
      <button type="button" class="btn btn-outline-info px-4 py-2" data-toggle="modal" data-target="#edit-team">新しいグループの作成</button>
    </div>
      <% @teams.each do |team| %>
      <%= link_to team.name,"/teams/"+team.uid, class: 'btn btn-outline-info py-3 mb-2 mx-auto', :style=>"width:70%; font-size:x-large;" %>
    <% end %>
  </div>
</div>
<br>

<script>
  $(document).on('turbolinks:render', function() {location.reload()});

  // ログアウト処理
  // TODD: headerにまとめる際に消す。
  var firebaseConfig = {
    apiKey: "AIzaSyDfZ0p6ysbml7IByXoXC-2-1BGmRlS-61k",
    authDomain: "comm-list.firebaseapp.com",
    databaseURL: "https://comm-list.firebaseio.com",
    projectId: "comm-list",
    storageBucket: "comm-list.appspot.com",
    messagingSenderId: "383913072943",
    appId: "1:383913072943:web:94089ff7b73cf69c8529da",
    measurementId: "G-1LYEQJK8LQ"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

  const csrfTokenObj = () => {
    return { "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr('content') };
  }

  const railsLogout = () => {
    $.ajax({url: "/logout", type: "DELETE", headers: csrfTokenObj()})
      .done((data) => { 
        console.log("Rails logout!")
        })
      .fail((data) => { console.log("Rails logout failed!") });
  }

  const firebaseLogout = () => {
  firebase.auth().signOut()
    .then(()       => { railsLogout() })
    .catch((error) => { console.log(`Firebase logout failed!: ${error.message}`) });
}
</script>